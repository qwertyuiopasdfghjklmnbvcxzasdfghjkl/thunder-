"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var Vue=_interopDefault(require("vue")),OVERFLOW_PROPERTYS=["overflow","overflow-x","overflow-y"],SCROLL_TYPES=["scroll","auto"],ROOT=document.body,VERTICAL=["top","bottom"],HORIZONTAL=["left","right"],DEFAULT_PLACEMENT_QUEUE=["top","right","bottom","left"],MAX=4;function getBoxMargin(t,e){if(t){var i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),o=n.width,r=n.height,s=i.width,a=i.height,l=i.top-n.top,c=i.left-n.left,p=i.right-n.left,d=i.bottom-n.top,u=c+s/2,m=l+a/2,f={tl:{x:c,y:l},tr:{x:p,y:l},br:{x:p,y:d},bl:{x:c,y:d}};return{width:s,height:a,margin:{top:{placement:"top",size:l,start:f.tl,mid:{x:u,y:l},end:f.tr},bottom:{placement:"bottom",size:r-d,start:f.bl,mid:{x:u,y:d},end:f.br},left:{placement:"left",size:c,start:f.tl,mid:{x:c,y:m},end:f.bl},right:{placement:"right",size:o-p,start:f.tr,mid:{x:p,y:m},end:f.br}}}}}function getBestPlacement(t){return t.sort(function(t,e){return e.weight-t.weight})[0]}function checkScrollable(t){var e=window.getComputedStyle(t,null);return OVERFLOW_PROPERTYS.some(function(t){return~SCROLL_TYPES.indexOf(e[t])})}function getScrollContainer(t){if(!t)return ROOT;for(var e=t.parentNode;e&&e!==ROOT;){if(checkScrollable(e))return e;e=e.parentNode}return ROOT}function computeCoordinateBaseMid(t,e){var i=t.placement,n=t.mid,o=t.tw,r=t.th;switch(i){case"top":return{placement:"top-mid",x:n.x-o/2,y:n.y-r-e};case"bottom":return{placement:"bottom-mid",x:n.x-o/2,y:n.y+e};case"left":return{placement:"left-mid",x:n.x-o-e,y:n.y-r/2};case"right":return{placement:"right-mid",x:n.x+e,y:n.y-r/2}}}function computeCoordinateBaseEdge(t,e){var i=t.placement,n=t.start,o=t.end,r=t.dHor,s=t.dVer,a=t.tw,l=t.th,c=t.ew,p=t.eh,d=r>0,u=s>0;switch(i){case"top":return{placement:d?"top-end":"top-start",x:d?o.x-a:n.x,y:n.y-l-e,arrowsOffset:c/2};case"bottom":return{placement:d?"bottom-end":"bottom-start",x:d?o.x-a:n.x,y:o.y+e,arrowsOffset:c/2};case"left":return{placement:u?"left-end":"left-start",x:n.x-a-e,y:u?o.y-l:n.y,arrowsOffset:p/2};case"right":return{placement:u?"right-end":"right-start",x:o.x+e,y:u?o.y-l:n.y,arrowsOffset:p/2}}}function computePlacementInfo(t,e,i,n,o){if(t&&i){var r=n&&n.length?n:DEFAULT_PLACEMENT_QUEUE,s=getBoxMargin(t,e),a=s.width,l=s.height,c=s.margin,p=i.getBoundingClientRect(),d=p.width,u=p.height,m=(d-a)/2,f=(u-l)/2,h=r.length,v=Object.keys(c).map(function(t){var e=c[t],i=r.indexOf(e.placement);e.weight=i>-1?MAX-i:MAX-h;var n=~VERTICAL.indexOf(e.placement)&&e.size>u+o,s=n&&c.left.size>m&&c.right.size>m,a=HORIZONTAL.indexOf(e.placement)>-1&&e.size>d+o,l=a&&c.top.size>f&&c.bottom.size>f;return e.dVer=c.top.size-c.bottom.size,e.dHor=c.left.size-c.right.size,e.mod="edge",s||l?(e.mod="mid",e.weight+=3+e.weight/MAX,e):((n||a)&&(e.weight+=2+e.weight/MAX),e)});return Object.assign({ew:a,eh:l,tw:d,th:u,dw:m,dh:f},getBestPlacement(v))}}function computeArrowPos(t,e,i){var n=e+"px",o=e-2*i+"px";return{"top-start":{top:"100%",left:n},"top-mid":{top:"100%",left:"50%"},"top-end":{top:"100%",right:o},"bottom-start":{top:"0",left:n},"bottom-mid":{top:"0",left:"50%"},"bottom-end":{top:"0",right:o},"left-start":{top:n,left:"100%"},"left-mid":{top:"50%",left:"100%"},"left-end":{bottom:o,left:"100%"},"right-start":{top:n,left:"0"},"right-mid":{top:"50%",left:"0"},"right-end":{bottom:o,left:"0"}}[t]}function debounce(t,e){var i=void 0;return function(){var n=this,o=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(n,o)},e)}}var supportsPassive=!1;document.addEventListener("passive-check",function(){},{get passive(){supportsPassive={passive:!0}}});var main={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"v-tip-fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"v-tip-container",class:t.boxClass,style:t.boxStyle,on:{mouseenter:t.showTip,mouseleave:function(e){t.hiddenTip(!0)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.placement,expression:"placement"}],staticClass:"v-tip-arrows",class:t.placement,style:t.arrowBox}),t._v(" "),t.title?i("span",{staticClass:"v-tip-title"},[t._v("\n      "+t._s(t.title)+"\n    ")]):t._e(),t._v(" "),t.content?i("p",{staticClass:"v-tip-content",style:t.contentHeight},[t._v("\n      "+t._s(t.content)+"\n    ")]):t._e(),t._v(" "),t.customComponent?i(t.customComponent,t._g(t._b({tag:"component",on:{"hidden-tip":t.hiddenTip,"update-tip":t.updateTip}},"component",t.customProps,!1),t.customListeners)):t._e()],1)])},staticRenderFns:[],name:"Vtip",props:{title:{type:String,default:""},content:{type:String,default:""},customProps:{type:Object,default:function(){return{}}},customComponent:{type:[String,Function,Object],default:""},customListeners:Object,target:null,container:null,placements:{type:Array,default:function(){return["top","right","bottom","left"]}},duration:{type:Number,default:300},transition:Boolean,arrowsSize:{type:Number,default:8},width:{type:[String,Number],default:"auto"},height:{type:[String,Number],default:"auto"},zIndex:{type:Number,default:999},theme:{type:String,default:"light"},customClass:{type:String,default:""}},data:function(){return this.containerNode=null,this.targetParentNode=null,this.visibleTimer=null,{placement:"",visible:!1,arrowsPos:{}}},computed:{arrowBox:function(){return Object.assign({borderWidth:this.arrowsSize+"px"},this.arrowsPos)},boxStyle:function(){var t=this.width;return{width:"string"==typeof t?t:t+"px",zIndex:this.zIndex}},boxClass:function(){return[this.customClass,this.theme,this.transition?"transition-transfrom":""]},contentHeight:function(){var t=this.height;return{height:"string"==typeof t?t:t+"px"}}},methods:{showTip:function(){clearTimeout(this.visibleTimer),this.visible=!0},hiddenTip:function(t){t?this.visible=!1:this.setVisible(!1)},updateTip:function(){this.setContainerNode(),this.showTip(),this.asynSetCoordinate()},setContainerNode:function(){var t=this.$el,e=this.target,i=this.container,n=this.targetParentNode,o=this.containerNode;if(e&&e.parentNode!==n){this.targetParentNode=e.parentNode;var r=i||getScrollContainer(e);if(r!==o){t.parentNode!==r&&r.appendChild(t);var s=window.getComputedStyle(r,null).position;s&&"static"!==s||(r.style.position="relative"),o&&o.removeEventListener("scroll",this.scrollHandler,supportsPassive),checkScrollable(r)&&r.addEventListener("scroll",this.scrollHandler,supportsPassive),this.containerNode=r}}},setCoordinate:function(){var t=this.$el,e=this.target,i=this.containerNode,n=this.placements,o=this.arrowsSize;if(t&&e&&i){var r=computePlacementInfo(e,i,t,n,o),s="mid"===r.mod?computeCoordinateBaseMid(r,o):computeCoordinateBaseEdge(r,o);this.setArrowsPos(s),this.placement=s.placement;var a=s.x+i.scrollLeft,l=s.y+i.scrollTop;this.$el.style.transform="translate3d("+Math.floor(a)+"px, "+Math.floor(l)+"px, 0)"}},asynSetCoordinate:function(){this.$nextTick(this.setCoordinate)},setArrowsPos:function(t){var e=t.placement,i=t.arrowsOffset;this.arrowsPos=computeArrowPos(e,i,this.arrowsSize)},setVisible:function(t){var e=this;clearTimeout(this.visibleTimer),this.visibleTimer=setTimeout(function(){e.visible=t,e.visibleTimer=null},this.duration)},scrollHandler:debounce(function(){this.setCoordinate()},200),clearScrollEvent:function(){this.containerNode&&this.containerNode.removeEventListener("scroll",this.scrollHandler,supportsPassive)},removeParentNode:function(){this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},destroy:function(){this.clearScrollEvent(),this.removeParentNode(),this.$destroy()}}},VtipConstructor=Vue.extend(main),props=main.props,defaultOptions={};Object.keys(props).forEach(function(t){var e=props[t],i=e.default;e&&null!=e.default&&(defaultOptions[t]="function"==typeof i?i():i)});var vtipInstance=null;function tip(t){return t=t||{},vtipInstance&&vtipInstance.$el.parentNode?(Object.assign(vtipInstance,defaultOptions,t),vtipInstance.target?vtipInstance.updateTip():vtipInstance.hiddenTip(),vtipInstance):((vtipInstance=new VtipConstructor({propsData:t}).$mount()).updateTip(),vtipInstance)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function clearEvent(t){t._tipHandler&&(t.removeEventListener("click",t._tipHandler),t.removeEventListener("mouseenter",t._tipHandler)),t._tipMouseleaveHandler&&t.removeEventListener("mouseleave",t._tipMouseleaveHandler),delete t._tipHandler,delete t._tipMouseleaveHandler,delete t._tipOptions,delete t._tipInstance}var directive={install:function(t,e){var i=(e=e||{}).directiveName||"tip",n=["top","right","bottom","left"];t.directive(i,{bind:function(t,e){clearEvent(t);var i=e.modifiers,o=i.click,r=i.dark,s=i.transition,a=n.filter(function(t){return e.modifiers[t]});t._tipOptions=e.value,t._tipHandler=function(){if(null!=this._tipOptions){var t=this._tipOptions,e={placements:a.length?a:n,transition:s,theme:r?"dark":"light"},i="object"===(void 0===t?"undefined":_typeof(t))?Object.assign(e,t,{target:this}):Object.assign(e,{content:String(t),target:this});this._tipInstance=tip(i)}},t._tipMouseleaveHandler=function(){this._tipInstance&&this._tipInstance.hiddenTip()},o?t.addEventListener("click",t._tipHandler):t.addEventListener("mouseenter",t._tipHandler),t.addEventListener("mouseleave",t._tipMouseleaveHandler)},update:function(t,e){var i=e.value;i!==e.oldValue&&(t._tipOptions=i)},unbind:function(t){var e=t._tipInstance;e&&e.destroy&&e.destroy(),clearEvent(t)}})}},index={tip:tip,directive:directive};module.exports=index;
